<!--
  SYNC IMPACT REPORT
  ==================
  バージョン変更: [テンプレート] → 1.0.0
  変更種別: MAJOR（プレースホルダー全置換・初回批准）

  追加された原則:
  - I. 共有基盤の利用
  - II. ドメイン分離
  - III. TDD必須（非交渉）
  - IV. 実装ガードレール（非交渉）

  追加されたセクション:
  - 技術スタック（必須）
  - 認証・認可
  - 品質基準
  - 命名規約
  - テスト配置規約
  - 開発ワークフロー

  テンプレート整合確認:
  - .specify/templates/plan-template.md  ✅ Constitution Checkセクション存在・修正不要
  - .specify/templates/spec-template.md  ✅ 必須セクションが原則と整合
  - .specify/templates/tasks-template.md ✅ TDDフェーズがRed/Green/Refactorと整合

  保留TODO: なし
-->

# トレーニングECサイト憲章

## 技術スタック

- **フレームワーク**: Next.js 14 (App Router) + React 18
- **言語**: TypeScript 5 (strict mode)
- **スタイリング**: Tailwind CSS 3
- **バリデーション**: Zod
- **単体・統合テスト**: Vitest（`pnpm test:unit` / `pnpm test:integration`）
- **E2Eテスト**: Playwright（`pnpm test:e2e`）
- **パッケージマネージャー**: pnpm

## 核心原則

### I. 共有基盤の利用

UIコンポーネントは `components/`、APIユーティリティは `templates/api/`、共通処理は `foundation/` を使用しなければならない（MUST）。これらの基盤を迂回する独自実装は禁止する。既存基盤で要件を満たせない場合は基盤自体の拡張提案を行うこと（Domains・App ルートへの直接実装は認めない）。

**根拠**: 実装の一貫性を保ち、重複コードによるメンテナンスコストの増大を防ぐ。

### II. ドメイン分離

各ドメイン（Catalog, Cart, Orders, Products）は `src/domains/[domain]/` に独立して実装しなければならない（MUST）。ドメイン間の依存はAPI経由のみとし、直接インポートは禁止する。

**根拠**: ドメイン境界を明確にすることで、独立したテスト・デプロイ・変更を可能にする。

### III. TDD必須（非交渉）

テスト駆動開発（Red → Green → Refactor）は全ユーザーストーリー実装において必須とする。

- **Red フェーズ**: 4種のテスト（単体・UI単体・統合・E2E）を作成し、シェルで実行して失敗を確認する。テストは仕様ベース（Given-When-Then）で記述する。失敗理由は「未実装」のみ許可（設定ミスや構文エラーは修正してから次へ）。
- **Green フェーズ**: テストコードの変更は禁止（MUST NOT）。実装コードのみで全テストを通過させる。
- **Refactor フェーズ**: 当該ストーリーで変更したコードのみリファクタリング対象とする。全テストをシェルで実行して成功を確認する。

**根拠**: 仕様の誤解を早期に検出し、リグレッションを防止する。テストが存在しない機能は「完成」とみなさない。

### IV. 実装ガードレール（非交渉）

- **保護対象への改変禁止**: Foundation, Templates, Components, Samples への変更は禁止（MUST NOT）。変更が許可されるのは Contracts, Infrastructure, Domains, App ルート, Tests のみ。
- **未通過テストでの進行禁止**: テスト失敗が残る状態で次のユーザーストーリーに進んではならない（MUST NOT）。
- **段階的実装**: スタブ（NotImplementedError）を本番実装に置換する形で段階的に実装する。`spec.md` を唯一の情報源とし、要件のスキップを禁止する。

**根拠**: 品質の劣化を構造的に防止し、仕様からの逸脱を抑制する。

## 認証・認可

- **ロール**: `buyer`（購入者）, `admin`（管理者）
- **セッション方式**: Cookie-based セッション
- **セキュリティ**: CSRF対策必須、RBAC二重防御（画面遷移レベル + 業務実行レベル）

## 品質基準

- TypeScript strict モード + ESLint エラー 0件
- テストカバレッジ 80% 以上
- E2Eテスト: 主要導線をカバーし、実行証跡（スクリーンショット・ログ）の提示義務あり
- パフォーマンス: 一覧ページ初回ロード 3秒以内

## 命名規約

| 対象 | 規約 |
|------|------|
| ファイル名 | kebab-case |
| コンポーネント / 型 | PascalCase |
| 関数 | camelCase |
| 定数 | UPPER_SNAKE_CASE |

## テスト配置規約

- **本番テスト**: `tests/unit/domains/[domain]/`、`tests/integration/domains/[domain]/`、`tests/e2e/`
- **サンプルテスト**: `src/samples/tests/`（本番テストをサンプルディレクトリに追加してはならない）

## 開発ワークフロー

ユーザーストーリー単位でフェーズを分割し、独立した実装・テストを行う。`src/contracts/` を基盤として、`src/samples/` を参考に実装する。実装完了後に `nav.ts` へのエントリを追加することで段階的に機能を公開する。

## 統制

本憲章はプロジェクトの他のすべての慣行に優先する。修正にはドキュメント化・担当者の承認・移行計画が必要。全PR・レビューは本憲章への準拠を検証しなければならない（MUST）。

**バージョン**: 1.0.0 | **批准日**: 2026-02-27 | **最終改定日**: 2026-02-27
